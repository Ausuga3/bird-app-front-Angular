<div class="container py-4">
  <h2 class="mb-4">Usuarios</h2>

  <div class="row g-2 mb-3 align-items-center">
    <div class="col-12 col-md-6">
      <input type="text" [formControl]="searchControl" placeholder="Buscar por nombre o email" class="form-control" />
    </div>
  </div>

  @if (loading()) {
    <div class="d-flex flex-column align-items-center justify-content-center py-4">
      <div class="spinner-border text-primary" role="status" aria-hidden="true"></div>
      <p class="mt-3 mb-0">Cargando usuarios...</p>
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger d-flex align-items-center" role="alert">
      <i class="material-icons me-2">error</i>
      <div>{{ error() }}</div>
    </div>
  }

  @if (!loading() && !error() && filteredUsers().length > 0) {
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Estado</th>
            @if(isAdmin()) { <th>Acciones</th> }
          </tr>
        </thead>
        <tbody>
          @for (user of filteredUsers(); track user.id) {
            <tr>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td>{{ formatRole(user.rol) }}</td>
              <td>
                <span class="badge" [ngClass]="user.isActive ? 'bg-success' : 'bg-secondary'">{{ user.isActive ? 'Activo' : 'Deshabilitado' }}</span>
              </td>
              @if(isAdmin()) {
                <td>
                  <button class="btn btn-sm btn-outline-danger me-2" (click)="toggleActive(user)" title="Activar/Desactivar">
                    @if(user.isActive) { ðŸ”’ Deshabilitar } @else { ðŸ”“ Activar }
                  </button>
                  @if(requestedExpertIds().includes(user.id) && user.rol.name !== 'expert') {
                    <button class="btn btn-sm btn-success" (click)="approveExpert(user)" title="Aprobar como experto">Hacer experto</button>
                  }
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  @if (!loading() && !error() && filteredUsers().length === 0) {
    <div class="text-center py-5">
      <i class="material-icons fs-1 text-muted">search_off</i>
      <p class="mt-3">No se encontraron usuarios</p>
    </div>
  }
</div>

